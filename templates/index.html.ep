<!doctype html>
<html>
  <head>
     <meta charset="utf-8">
     <title>XAmbiServer - HomeMon</title>
      <link rel="stylesheet" href="//code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css">
      <script src="//code.jquery.com/jquery-1.10.2.js"></script>
      <script src="//code.jquery.com/ui/1.11.1/jquery-ui.js"></script>
      <script type="text/javascript" src="https://www.google.com/jsapi"></script>
      <style>
        #toolbar {
          padding: 4px;
          display: inline-block;
        }
        /* support: IE7 */
        *+html #toolbar {
          display: inline;
        }
      </style>

      <script type="text/javascript">
         google.load("visualization", "1", {packages:["gauge"]});
       </script>


      <script>
      $(function() {

         $( "#addgroup" ).button({
               icons: {
                 primary: "ui-icon-locked"
               },
             });
         $( "#help" ).button({
               icons: {
                 primary: "ui-icon-gear"
               },
               text: false
             });

         var tabs = $( "#Rooms" ).tabs();
         var tabCounter = 1;
      
         // get all exists groups via Ajax
         $.getJSON( '<%= url_for 'geras' %>?sub=groups', function( data ) {
            var d = data.groups;
            for (var group in data.groups) {
               addTab( group, data.groups[group]);            
            }
          });
      
         function addTab(group, series) {
            var groupname = group.split("/");
            var label = groupname[groupname.length-1].ucfirst();
            var id = "tabs-" + tabCounter;
            var li = "<li><a href='#" + id + "'>" + label + "</a><span class='ui-icon ui-icon-close' role='presentation'>Remove Tab</span></li>";
       
            tabs.find( ".ui-tabs-nav" ).append( li );
            tabs.append( "<div id='" + id + "'><p>" + series.join('<br>') + "</p></div>" );
            tabs.tabs( "refresh" );
            tabCounter++;

            addTabContent(id, series);
         }  

         function addTabContent(divid, series) {
            for(var i=0;i<series.length;i++){
               $.getJSON( '<%= url_for 'sensor' %>?sub=type&topic=' + series[i], function( data ) {
                  // Call correct Widget and draw
                  if(data.type && data.topic){
                     var evalStr = "createWidget_" + data.type + "('" + data.topic + "', '" + divid + "')";
                     console.log(evalStr);
                     eval(evalStr);
                  }
               });
            }
         }


         /* --------------- WIDGETS -------------------*/
         function createWidget_Humidity(serie, divid){
            //create google Gauge and get
            
            // Anzeigen der Werte Power Temperatur und Feuchtigkeit in Einem Widget

            var data = google.visualization.arrayToDataTable([
             ['Label', 'Value'],
             ['Humidity', 0],
            ]);
            
            var options = {
             width: 400, height: 120,
             redFrom: 0, redTo: 25,
             yellowFrom:25, yellowTo: 75,
             blueFrom:75, blueTo: 100,
             minorTicks: 5
            };
            
            var chart = new google.visualization.Gauge(document.getElementById(divid));
            
            chart.draw(data, options);
         }


         /* --------------- PROTOTYPES ----------------*/
         String.prototype.ucfirst = function()
         {
             return this.charAt(0).toUpperCase() + this.substr(1);
         }

      });
      </script>
    </head>
<body style='font-family: "Trebuchet MS", "Helvetica", "Arial",  "Verdana", "sans-serif";font-size: 62.5%;'>

<div id="toolbar" class="ui-widget-header ui-corner-all">
  <button id="addgroup">Add group</button>
  <button id="help">?</button>
</div>
    
<div id="Rooms"><ul></ul></div>

</body>
</html>

