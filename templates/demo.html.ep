<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <!-- Ignite UI Required Combined CSS Files -->
    <link href="http://cdn-na.infragistics.com/igniteui/2014.2/latest/css/themes/infragistics/infragistics.theme.css" rel="stylesheet" />
    <link href="http://cdn-na.infragistics.com/igniteui/2014.2/latest/css/structure/infragistics.css" rel="stylesheet" />

    <!-- Modernizr/jQuery/jQuery UI -->
    <script src="http://modernizr.com/downloads/modernizr-latest.js"></script>
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.min.js"></script>

    <!-- Ignite UI Required Combined JavaScript Files -->
    <script src="http://cdn-na.infragistics.com/igniteui/2014.2/latest/js/infragistics.core.js"></script>
    <script src="http://cdn-na.infragistics.com/igniteui/2014.2/latest/js/infragistics.lob.js"></script>

    <script src="http://www.igniteui.com/data-files/candidates.js"></script>
</head>
<body>
    <style type="text/css">
        .ui-widget{
            font-size:0.9em
         }

        .dashboard {
            position: relative;
            width: 100%;
            height: 500px;
        }

        #dashboard h4 {
            font-size: 18px;
            text-align: center;
        }

        #dashboard h3 {
            text-align: center;
        }

        #dashboard img {
            width: 150px;
            height: 175px;
            margin-left: -75px;
            margin-top: 15px;
            position: absolute;
            left: 50%;
        }

        #dashboard .ui-igtile-maximized img {
            width: 200px;
            height: 250px;
            position: static;
            float: left;
            margin: 20px 20px 20px 0;
        }

        #dashboard .ui-igtilemanager-right img {
            width: 60px;
            height: 80px;
            margin-left: -30px;
            margin-top: 15px;
        }

        .ui-igtile-maximized .text {
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .ui-igtile-maximized div {
            text-align: left;
        }

        .linkedIn, .skills {
            word-wrap: break-word;
        }

        @media all and (max-width: 430px) {

            #dashboard h4 {
                margin: 0 0 5px;
                height: 50px;
            } 

            #dashboard h3 {
                clear: both;
                margin: 0 0 5px;
            }

            #dashboard img {
                width: 100%;
                height: 150px;
                margin:0;
                position: static;
                float: none;
            }

            .ui-igtile-maximized .text {
                font-size: 16px;
                margin-top: 10px;
            }

            #dashboard .ui-igtile-maximized img {
                width: 100%;
                height: 175px;
                margin: 0;
                float: none;
            }

            #dashboard .ui-igtilemanager-right img {
                width: 100%;
                height: 80px;
                margin: 0;
            }
        }

        #dashboard .color {
            color: blue;
        }
    </style>
    
    <div id="tabs"><ul></ul></div>
    

    <script type="text/javascript">
        $(function () {
            /* --------------- VARS ----------------*/
            var tabCounter = 2;

            /* --------------- INIT ----------------*/
            var tabs = $( "#tabs" ).tabs();

            // get all exists groups via Ajax
            $.getJSON( '<%= url_for 'geras' %>?sub=groups', function( data ) {
               var d = data.groups;
               for (var group in data.groups) {
                  addTab( group, data.groups[group]);            
                  tabCounter++;
               }
            });

            /* --------------- FUNCTIONS ----------------*/
            function addTab(group, series) {
               var groupname = group.split("/");
               var dashboardId = 'dashboard-' + tabCounter;
               var label = groupname[groupname.length-1].ucfirst();
               var id = "tabs-" + tabCounter;
               var li = "<li><a href='#" + dashboardId + "'>" + label + "</a></li>";

               tabs.find( ".ui-tabs-nav" ).append( li );
               tabs.append( "<div class='dashboard' id='" + dashboardId + "'></div>" );
               tabs.tabs( "refresh" );


               var ds = new $.ig.DataSource({ 
                  type: "json", 
                  dataSource: '/geras?sub=groups&type=sensorgrp&subparams=' + group
               }).dataBind();

               $('#' + dashboardId).igTileManager({
                   marginLeft: 10,
                   marginTop: 10,
                   rightPanelTilesWidth: 200,
                   rightPanelTilesHeight: 156,
                   maximizedState: '<h3>${name}</h3><p class="text">${text}</p>' +
                   '<div style="clear: both"><span class="color">Skills:</span></div>' +
                   '<ul class="skills">{{each ${value} }}<li>${value.topic}</li>{{/each}}</ul>',
                   minimizedState: '<h4>${name}</h4>',
                   dataSource: ds,
                   rendered: function (event, ui) {
                     $('#' + dashboardId).find('ul').igTree();
                   },
               });
            }  
   


            /* --------------- PROTOTYPES ----------------*/
            String.prototype.ucfirst = function()
            {
                return this.charAt(0).toUpperCase() + this.substr(1);
            }
            

        });
    </script>
    <span id="minimizedState">
      
    </span>

</body>
</html>